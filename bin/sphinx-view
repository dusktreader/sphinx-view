#!/usr/bin/env python

import tempfile

from argparse import ArgumentParser, ArgumentDefaultsHelpFormatter
from sview import create_server, build
import os

if __name__ == '__main__':
    parser = ArgumentParser(
        formatter_class=ArgumentDefaultsHelpFormatter,
        description='Start the Flask webserver',
        )
    parser.add_argument(
        '-p',
        '--port',
        type=int,
        default=5656,
        help='Set the flask webserver port',
        )
    parser.add_argument(
        '-s',
        '--source-dir',
        help='Include autodoc for sources at DIR',
        )
    parser.add_argument(
        'target',
        nargs=1,
        help='The target to view',
    )
    args = parser.parse_args()

    target = args.target.pop()

    with tempfile.TemporaryDirectory() as working_dir:
        server = create_server(
            TARGET=target,
            WORKING_DIR=working_dir,
            SERVER_PORT=args.port,
            SOURCE_DIR=args.source_dir,
        )
        server.serve(
            port=args.port,
            host='localhost',
            open_url_delay=0.5,
        )
